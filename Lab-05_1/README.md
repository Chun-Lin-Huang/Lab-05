## Lab-05_1：圖書館資料庫設計
### 情境：
* 請為圖書館設計資料庫。圖書館需要追蹤書籍、會員以及借閱記錄。
### 資料基本包含：
* 書籍：ISBN、書名、作者 (可能多位)、出版社名稱、出版社地址、出版年份、書籍類別。
* 會員：會員卡號、會員姓名、會員地址、會員電話、會員Email。
* 借閱：會員卡號、會員姓名、ISBN、書名、借閱日期、應還日期、實際歸還日期。
### 識別問題
#### 重複資料：
1. 同一本書的資訊會重複出現多次
* 原因：
    * 在未正規化的資料表中，書籍資訊和借閱紀錄混在同一張表裡，當同一本書被不同會員借閱時，每一次借閱都會重複記錄那本書的所有資訊。
* 例：

| 會員卡號 | 姓名 | ISBN         | 書名         | 作者        | 出版社     | 借閱日期   |
|----------|------|--------------|--------------|-------------|------------|------------|
| C001     | 張三 | 9781234567890 | 演算法導論   | Cormen 等人 | 東大出版社 | 2024-05-01 |
| C002     | 李四 | 9781234567890 | 演算法導論   | Cormen 等人 | 東大出版社 | 2024-05-10 |

- `9781234567890` 這本書出現了 **兩筆借閱紀錄**。
- 每筆紀錄都**重複寫了書名、作者、出版社資訊**。
2. 同一位會員每次借書都會重複記錄姓名、地址、電話等資料
* 原因：
    * 跟上面差不多，也是因為會員資訊和借閱紀錄混在同一張表中。
#### 插入異常：
1. 無法新增一本書或一位會員，除非有借閱紀錄
* 原因：
    * 在未正規化的資料表中，所有資訊（會員、書籍、借閱）都混在同一張表裡，所以想新增一本書或一位會員的資料，但還沒有任何借閱紀錄時，就無法插入。
* 例：想新增一本書，但這本書還沒被借過
    > 無法只新增書籍資訊，因為這張表沒有「只記錄書籍」的空間。
* 例：想新增一位會員，但她還沒借書
    > 無法只新增會員，因為表格只設計來記錄「誰借了什麼書」。
#### 更新異常：
1. 修改會員聯絡方式就要修改所有該會員的借閱記錄
* 例子：假設張三換了手機號碼
    * 他借了兩本書，就有兩筆紀錄包含他舊的電話。
    * **必須同時修改所有借閱紀錄中的電話號碼**才能更新完整資訊。
    * 若忘記改其中一筆，就會導致資料不一致，查詢錯誤或寄信失敗。
2. 出版社地址如果變更就要修改所有書籍紀錄
* 例子：假設東大出版社搬家
    * 所有來自「東大出版社」的書籍都在每筆借閱紀錄裡重複記了地址。
    * 要修改就要在**每一筆含有東大出版社的紀錄中都更新地址**。
    * 只改部分資料會導致資料不一致，甚至無法知道正確的新地址是哪個。
#### 刪除異常：
1. 如果刪除一筆唯一的借閱紀錄，可能會導致書籍或會員資訊不見

### 函數相依性
| 函數                                          | 相依                 |
|----------------------------------------------|---------------------------|
| 會員卡號                            | 會員姓名, 地址, 電話, Email         |
| ISBN                           | 書名, 類別, 出版年份, 出版社名稱            |
| 出版社名稱                              |出版社地址 |
| ISBN                                     | 作者     |
| (會員卡號, ISBN, 借閱日期)           | 應還日期           |
| ISBN                     | 出版社名稱 → 出版社地址     |
### 未正規化前的資料表
| 會員卡號 | 會員姓名 | 會員地址     | 會員電話   | 會員 Email         | ISBN         | 書名         | 作者                  | 出版社名稱 | 出版社地址     | 出版年份 | 書籍類別 | 借閱日期   | 應還日期   | 實際歸還日期 |
|----------|----------|--------------|------------|--------------------|--------------|--------------|-----------------------|------------|----------------|----------|----------|------------|------------|----------------|
| C001     | 張三     | 台北市中山區 | 0912345678 | zhang@example.com  | 9781234567890 | 演算法導論   | Cormen, Leiserson     | 東大出版社 | 台北市中正區   | 2020     | 計算機     | 2024-05-01 | 2024-05-15 | 2024-05-14      |
| C001     | 張三     | 台北市中山區 | 0912345678 | zhang@example.com  | 9789876543210 | 資料結構     | Mark Allen Weiss      | 東大出版社 | 台北市中正區   | 2018     | 資訊       | 2024-05-03 | 2024-05-17 |                |
| C002     | 李四     | 新北市板橋區 | 0987654321 | li@example.com     | 9781234567890 | 演算法導論   | Cormen, Leiserson     | 東大出版社 | 台北市中正區   | 2020     | 計算機     | 2024-05-04 | 2024-05-18 |                |
### 第一正規化（1NF）
#### 借閱紀錄資料表
| 會員卡號 | 姓名 | 地址         | 電話       | Email              | ISBN         | 書名         | 出版社     | 出版社地址   | 出版年份 | 書籍類別 | 借閱日期   | 應還日期   |
|----------|------|--------------|------------|--------------------|--------------|--------------|------------|----------------|----------|----------|------------|------------|
| C001     | 張三 | 台北市中山區 | 0912345678 | zhang@example.com  | 9781234567890 | 演算法導論   | 東大出版社 | 台北市中正區   | 2020     | 計算機     | 2024-05-01 | 2024-05-15 |
| C002     | 李四 | 新北市板橋區 | 0987654321 | li@example.com     | 9781234567890 | 演算法導論   | 東大出版社 | 台北市中正區   | 2020     | 計算機     | 2024-05-04 | 2024-05-18 |
| C001     | 張三 | 台北市中山區 | 0912345678 | zhang@example.com  | 9789876543210 | 資料結構     | 東大出版社 | 台北市中正區   | 2018     | 資訊       | 2024-05-03 | 2024-05-17 |

#### 書籍作者資料表
| ISBN         | 作者名稱         |
|--------------|------------------|
| 9781234567890 | Cormen           |
| 9781234567890 | Leiserson        |
| 9789876543210 | Mark Allen Weiss |

### 第一正規化說明
**目的**：
- 消除多值欄位與重複群組，確保所有欄位皆為不可分割的原子值（Atomic）。

**做法**：
- 將原始「作者」欄位中出現多位作者拆解為多筆資料。
- 建立獨立的 `書籍作者資料表`記錄每筆 ISBN 對應的作者。

**結果**：
- 每一筆資料都是獨立的原子值組合。
- 書籍與作者之間的多對多關係結構化。

### 第二正規化（2NF）
#### 會員資料表
| 會員卡號 | 會員姓名 | 會員地址         | 會員電話       | 會員 Email        |
|----------|----------|--------------|------------|--------------------|
| C001     | 張三     | 台北市中山區 | 0912345678 | zhang@example.com  |
| C002     | 李四     | 新北市板橋區 | 0987654321 | li@example.com     |

#### 書籍資料表

| ISBN         | 書名         | 出版社名稱 | 出版社地址   | 出版年份 | 書籍類別 |
|--------------|--------------|------------|----------------|----------|----------|
| 9781234567890 | 演算法導論  | 東大出版社 | 台北市中正區   | 2020   | 計算機   |
| 9789876543210 | 資料結構  | 東大出版社 | 台北市中正區   | 2018     | 資訊     |

#### 借閱紀錄資料表
> 主鍵： (會員卡號, ISBN, 借閱日期)

| 會員卡號 | ISBN         | 借閱日期   | 應還日期   |
|----------|--------------|------------|------------|
| C001     | 9781234567890 | 2024-05-01 | 2024-05-15 |
| C002     | 9781234567890 | 2024-05-04 | 2024-05-18 |
| C001     | 9789876543210 | 2024-05-03 | 2024-05-17 |

#### 書籍作者資料表
| ISBN         | 作者名稱         |
|--------------|------------------|
| 9781234567890 | Cormen           |
| 9781234567890 | Leiserson        |
| 9789876543210 | Mark Allen Weiss |

### 第二正規化說明
**目的**：
- 消除**部分相依性**，確保所有非主鍵欄位完全依賴整個主鍵。

**做法**：
將部分相依的欄位拆出為獨立資料表，避免資料重複與更新異常：

| 拆出欄位                     | 對應資料表    | 主鍵         |
|------------------------------|---------------|--------------|
| 會員姓名、地址、電話、Email | `會員資料表 Member`      | 會員卡號     |
| 書名、出版社、出版年等       | `書籍資料表 Book`        | ISBN         |
| 書籍作者（多對多）           | `書籍作者資料表 Authorship`  | ISBN + 作者名稱 |
| 借閱行為                     | `借閱紀錄資料表 Borrow`      | 會員卡號 + ISBN + 借閱日期 |

**結果**：
- 避免同一本書或同一位會員資料重複出現在多筆借閱紀錄中。
- 強化資料一致性與可維護性。

### 第三正規化（3NF）
#### 書籍資料表
| ISBN         | 書名         | 出版社名稱 | 出版年份 | 書籍類別 |
|--------------|--------------|------------|----------|----------|
| 9781234567890 | 演算法導論   | 東大出版社 | 2020     | 計算機     |
| 9789876543210 | 資料結構     | 東大出版社 | 2018     | 資訊       |

#### 出版社資料表
| 出版社名稱 | 出版社地址   |
|------------|----------------|
| 東大出版社 | 台北市中正區   |

#### 會員資料表
| 會員卡號 | 會員姓名 | 會員地址     | 會員電話   | 會員 Email         |
|----------|----------|--------------|------------|--------------------|
| C001     | 張三     | 台北市中山區 | 0912345678 | zhang@example.com  |
| C002     | 李四     | 新北市板橋區 | 0987654321 | li@example.com     |

#### 借閱紀錄資料表
> 主鍵： (會員卡號, ISBN, 借閱日期)

| 會員卡號 | ISBN         | 借閱日期   | 應還日期   |
|----------|--------------|------------|------------|
| C001     | 9781234567890 | 2024-05-01 | 2024-05-15 |
| C002     | 9781234567890 | 2024-05-04 | 2024-05-18 |
| C001     | 9789876543210 | 2024-05-03 | 2024-05-17 |

#### 書籍作者資料表
| ISBN         | 作者名稱         |
|--------------|------------------|
| 9781234567890 | Cormen           |
| 9781234567890 | Leiserson        |
| 9789876543210 | Mark Allen Weiss |

### 第三正規化說明
**目的**：
- 消除**傳遞相依性**，確保所有非主鍵欄位只依賴主鍵，而不透過其他非主鍵欄位間接相依。

**做法**：
- 出版社地址依賴出版社名稱，而出版社名稱依賴 ISBN，因此需將出版社資訊抽離書籍表。
- 結構：ISBN → 出版社名稱 → 出版社地址 ⇒ 將「出版社地址」抽離。

**結果**：
- 書籍表不再內含傳遞相依欄位，資料變得更純淨、更容易維護。
- 任一出版社地址更新只需改一筆資料，避免不一致或重複修改
### BCNF 正規化
#### 出版社資料表
* `PublisherID` 為主鍵。  
* 避免讓「出版社名稱」決定地址，否則在多地分社情境下不唯一，會違反 BCNF。

| PublisherID | 出版社名稱 | 出版社地址   |
|-------------|-------------|----------------|
| PUB001      | 東大出版社   | 台北市中正區   |

#### 書籍資料表
| ISBN         | 書名         | 出版年份 | 書籍類別 | PublisherID |
|--------------|--------------|----------|----------|-------------|
| 9781234567890 | 演算法導論   | 2020     | 計算機     | PUB001      |
| 9789876543210 | 資料結構     | 2018     | 資訊       | PUB001      |

#### 會員資料表
| 會員卡號 | 會員姓名 | 會員地址     | 會員電話   | 會員 Email         |
|----------|----------|--------------|------------|--------------------|
| C001     | 張三     | 台北市中山區 | 0912345678 | zhang@example.com  |
| C002     | 李四     | 新北市板橋區 | 0987654321 | li@example.com     |

#### 借閱紀錄資料表
| 會員卡號 | ISBN         | 借閱日期   | 應還日期   |
|----------|--------------|------------|------------|
| C001     | 9781234567890 | 2024-05-01 | 2024-05-15 |
| C002     | 9781234567890 | 2024-05-04 | 2024-05-18 |
| C001     | 9789876543210 | 2024-05-03 | 2024-05-17 |

#### 書籍作者資料表
| ISBN         | 作者名稱         |
|--------------|------------------|
| 9781234567890 | Cormen           |
| 9781234567890 | Leiserson        |
| 9789876543210 | Mark Allen Weiss |

### BCNF 正規化說明
**目的**：
- 解決 3NF 難以處理的函數相依問題，**確保所有決定項皆為超鍵（Superkey）**。

**做法**：
- 發現 `出版社名稱 → 出版社地址`，但出版社名稱若非主鍵（可能重複），即違反 BCNF。
- 解決方式：建立唯一的 `PublisherID` 作為主鍵。
  - `出版社資訊(PublisherID, 名稱, 地址)`
  - `書籍資料(ISBN, 書名, ..., PublisherID)`

**結果**：
- 所有函數相依中的決定項皆為超鍵，完全符合 BCNF。
- 結構更嚴謹，便於資料一致性與規模擴展。

### 實體關係圖 (ERD)
![Lab_05_1](Lab_05_1)